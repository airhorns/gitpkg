{"version":3,"file":"read-config.js","names":["_findUp","_interopRequireDefault","require","_fs","_bluebird","_path","_getGitTagName","e","__esModule","default","access","bluebird","promisify","fs","configFileName","exports","defaultConfig","registry","getTagName","defaultTagNameFormat","getNearestConfigFile","path","resolve","process","cwd","findUp","readConfig","configPath","configClass","config"],"sources":["../../../src/tasks/Task/read-config.js"],"sourcesContent":["import findUp from 'find-up';\nimport fs from 'fs';\nimport bluebird from 'bluebird';\nimport path from 'path';\nimport { defaultTagNameFormat } from '../Publish/get-git-tag-name';\n\nconst access = bluebird.promisify(fs.access);\n\n/**\n * The name of the config file.\n */\nexport const configFileName = 'gitpkg.config.js';\n\n/**\n * Here goes any default values.\n */\nexport const defaultConfig = {\n  registry: null,\n  getTagName: defaultTagNameFormat\n};\n\nexport async function getNearestConfigFile() {\n  // First check if config file is in same dir\n  try {\n    if (await access(path.resolve(process.cwd(), configFileName))) {\n      return configFileName;\n    }\n  } catch (e) {\n    // Ignore\n  }\n\n  // Then check in parent directories\n  return findUp(configFileName);\n}\n\n/**\n * Returns an object with configurable settings.\n *\n * @param {string} directory Path to config file.\n */\nexport default async function readConfig(configPath) {\n  try {\n    const configClass = await import(configPath);\n    let config = {};\n\n    if (typeof configClass.default === 'function') {\n      config = configClass.default();\n    } else if (typeof configClass === 'function') {\n      config = configClass();\n    }\n\n    return { ...defaultConfig, ...config };\n  } catch (e) {\n    return defaultConfig;\n  }\n}\n"],"mappings":";;;;;;;;;AAAA,IAAAA,OAAA,GAAAC,sBAAA,CAAAC,OAAA;AACA,IAAAC,GAAA,GAAAF,sBAAA,CAAAC,OAAA;AACA,IAAAE,SAAA,GAAAH,sBAAA,CAAAC,OAAA;AACA,IAAAG,KAAA,GAAAJ,sBAAA,CAAAC,OAAA;AACA,IAAAI,cAAA,GAAAJ,OAAA;AAAmE,SAAAD,uBAAAM,CAAA,WAAAA,CAAA,IAAAA,CAAA,CAAAC,UAAA,GAAAD,CAAA,KAAAE,OAAA,EAAAF,CAAA;AAEnE,MAAMG,MAAM,GAAGC,iBAAQ,CAACC,SAAS,CAACC,WAAE,CAACH,MAAM,CAAC;;AAE5C;AACA;AACA;AACO,MAAMI,cAAc,GAAAC,OAAA,CAAAD,cAAA,GAAG,kBAAkB;;AAEhD;AACA;AACA;AACO,MAAME,aAAa,GAAAD,OAAA,CAAAC,aAAA,GAAG;EAC3BC,QAAQ,EAAE,IAAI;EACdC,UAAU,EAAEC;AACd,CAAC;AAEM,eAAeC,oBAAoBA,CAAA,EAAG;EAC3C;EACA,IAAI;IACF,IAAI,MAAMV,MAAM,CAACW,aAAI,CAACC,OAAO,CAACC,OAAO,CAACC,GAAG,CAAC,CAAC,EAAEV,cAAc,CAAC,CAAC,EAAE;MAC7D,OAAOA,cAAc;IACvB;EACF,CAAC,CAAC,OAAOP,CAAC,EAAE;IACV;EAAA;;EAGF;EACA,OAAO,IAAAkB,eAAM,EAACX,cAAc,CAAC;AAC/B;;AAEA;AACA;AACA;AACA;AACA;AACe,eAAeY,UAAUA,CAACC,UAAU,EAAE;EACnD,IAAI;IACF,MAAMC,WAAW,GAAG,MAAM,MAAM,CAACD,UAAU,CAAC;IAC5C,IAAIE,MAAM,GAAG,CAAC,CAAC;IAEf,IAAI,OAAOD,WAAW,CAACnB,OAAO,KAAK,UAAU,EAAE;MAC7CoB,MAAM,GAAGD,WAAW,CAACnB,OAAO,CAAC,CAAC;IAChC,CAAC,MAAM,IAAI,OAAOmB,WAAW,KAAK,UAAU,EAAE;MAC5CC,MAAM,GAAGD,WAAW,CAAC,CAAC;IACxB;IAEA,OAAO;MAAE,GAAGZ,aAAa;MAAE,GAAGa;IAAO,CAAC;EACxC,CAAC,CAAC,OAAOtB,CAAC,EAAE;IACV,OAAOS,aAAa;EACtB;AACF","ignoreList":[]}