{"version":3,"file":"index.js","names":["_Task","_interopRequireDefault","require","_execLifecycleScript","_preparePackage","_uploadPackage","_getRegistryUrl","_getGitTagName","e","__esModule","default","PublishTask","Task","run","registry","configPath","pkgPath","emit","readConfigFile","readPackageManifest","execLifecycleScript","pkg","preparePackage","gitpkgRegistryURL","getRegistryURL","config","uploadPackage","gitpkgRegistry","gitpkgPackage","getGitTagName","name","version","exports"],"sources":["../../../src/tasks/Publish/index.js"],"sourcesContent":["import Task from '../Task';\nimport execLifecycleScript from './exec-lifecycle-script';\nimport preparePackage from './prepare-package';\nimport uploadPackage from './upload-package';\nimport getRegistryURL from './get-registry-url';\nimport getGitTagName from './get-git-tag-name';\n\nexport default class PublishTask extends Task {\n  async run({ registry, configPath, pkgPath }) {\n    this.emit('subtask', 1, 6, 'üéõ  Reading config file');\n    // 1 - Read config.\n    await this.readConfigFile(configPath);\n    this.emit('subtask', 2, 6, 'üëÄ  Reading and validating package.json');\n    // 1 - Read and validate package.json.\n    await this.readPackageManifest(pkgPath);\n    this.emit('subtask', 3, 6, 'üèá  Running prepublish scripts');\n    // 2 - Run prepublish scripts.\n    // NOTE: this scripts might modify the package.json so we need to reload it.\n    await execLifecycleScript('prepublish', this.pkg, pkgPath, async () => {\n      await this.readPackageManifest(pkgPath);\n    });\n    await execLifecycleScript('prepublishOnly', this.pkg, pkgPath, async () => {\n      await this.readPackageManifest(pkgPath);\n    });\n    await execLifecycleScript('prepare', this.pkg, pkgPath, async () => {\n      await this.readPackageManifest(pkgPath);\n    });\n    // 3 - Prepare package: npm pack and untar tarball to temp dir.\n    this.emit('subtask', 4, 6, '‚öôÔ∏è  Preparing package');\n    await preparePackage(this.pkg, pkgPath);\n    this.emit('subtask', 5, 6, '‚¨ÜÔ∏è  Uploading package');\n    // 4 - Upload package: create git tag from temp dir\n    // and push to resolved gitpkg registry.\n    const gitpkgRegistryURL = await getRegistryURL(registry, this.pkg, pkgPath, this.config);\n    await uploadPackage(this.config, this.pkg, gitpkgRegistryURL);\n    // 5 - Run postpublish scripts.\n    this.emit('subtask', 6, 6, 'üèá Running postpublish scripts');\n    await execLifecycleScript('postpublish', this.pkg, pkgPath);\n\n    return {\n      gitpkgRegistry: gitpkgRegistryURL,\n      gitpkgPackage: getGitTagName(this.pkg, this.config),\n      name: this.pkg.name,\n      version: this.pkg.version\n    };\n  }\n}\n"],"mappings":";;;;;;AAAA,IAAAA,KAAA,GAAAC,sBAAA,CAAAC,OAAA;AACA,IAAAC,oBAAA,GAAAF,sBAAA,CAAAC,OAAA;AACA,IAAAE,eAAA,GAAAH,sBAAA,CAAAC,OAAA;AACA,IAAAG,cAAA,GAAAJ,sBAAA,CAAAC,OAAA;AACA,IAAAI,eAAA,GAAAL,sBAAA,CAAAC,OAAA;AACA,IAAAK,cAAA,GAAAN,sBAAA,CAAAC,OAAA;AAA+C,SAAAD,uBAAAO,CAAA,WAAAA,CAAA,IAAAA,CAAA,CAAAC,UAAA,GAAAD,CAAA,KAAAE,OAAA,EAAAF,CAAA;AAEhC,MAAMG,WAAW,SAASC,aAAI,CAAC;EAC5C,MAAMC,GAAGA,CAAC;IAAEC,QAAQ;IAAEC,UAAU;IAAEC;EAAQ,CAAC,EAAE;IAC3C,IAAI,CAACC,IAAI,CAAC,SAAS,EAAE,CAAC,EAAE,CAAC,EAAE,yBAAyB,CAAC;IACrD;IACA,MAAM,IAAI,CAACC,cAAc,CAACH,UAAU,CAAC;IACrC,IAAI,CAACE,IAAI,CAAC,SAAS,EAAE,CAAC,EAAE,CAAC,EAAE,yCAAyC,CAAC;IACrE;IACA,MAAM,IAAI,CAACE,mBAAmB,CAACH,OAAO,CAAC;IACvC,IAAI,CAACC,IAAI,CAAC,SAAS,EAAE,CAAC,EAAE,CAAC,EAAE,gCAAgC,CAAC;IAC5D;IACA;IACA,MAAM,IAAAG,4BAAmB,EAAC,YAAY,EAAE,IAAI,CAACC,GAAG,EAAEL,OAAO,EAAE,YAAY;MACrE,MAAM,IAAI,CAACG,mBAAmB,CAACH,OAAO,CAAC;IACzC,CAAC,CAAC;IACF,MAAM,IAAAI,4BAAmB,EAAC,gBAAgB,EAAE,IAAI,CAACC,GAAG,EAAEL,OAAO,EAAE,YAAY;MACzE,MAAM,IAAI,CAACG,mBAAmB,CAACH,OAAO,CAAC;IACzC,CAAC,CAAC;IACF,MAAM,IAAAI,4BAAmB,EAAC,SAAS,EAAE,IAAI,CAACC,GAAG,EAAEL,OAAO,EAAE,YAAY;MAClE,MAAM,IAAI,CAACG,mBAAmB,CAACH,OAAO,CAAC;IACzC,CAAC,CAAC;IACF;IACA,IAAI,CAACC,IAAI,CAAC,SAAS,EAAE,CAAC,EAAE,CAAC,EAAE,uBAAuB,CAAC;IACnD,MAAM,IAAAK,uBAAc,EAAC,IAAI,CAACD,GAAG,EAAEL,OAAO,CAAC;IACvC,IAAI,CAACC,IAAI,CAAC,SAAS,EAAE,CAAC,EAAE,CAAC,EAAE,uBAAuB,CAAC;IACnD;IACA;IACA,MAAMM,iBAAiB,GAAG,MAAM,IAAAC,uBAAc,EAACV,QAAQ,EAAE,IAAI,CAACO,GAAG,EAAEL,OAAO,EAAE,IAAI,CAACS,MAAM,CAAC;IACxF,MAAM,IAAAC,sBAAa,EAAC,IAAI,CAACD,MAAM,EAAE,IAAI,CAACJ,GAAG,EAAEE,iBAAiB,CAAC;IAC7D;IACA,IAAI,CAACN,IAAI,CAAC,SAAS,EAAE,CAAC,EAAE,CAAC,EAAE,gCAAgC,CAAC;IAC5D,MAAM,IAAAG,4BAAmB,EAAC,aAAa,EAAE,IAAI,CAACC,GAAG,EAAEL,OAAO,CAAC;IAE3D,OAAO;MACLW,cAAc,EAAEJ,iBAAiB;MACjCK,aAAa,EAAE,IAAAC,sBAAa,EAAC,IAAI,CAACR,GAAG,EAAE,IAAI,CAACI,MAAM,CAAC;MACnDK,IAAI,EAAE,IAAI,CAACT,GAAG,CAACS,IAAI;MACnBC,OAAO,EAAE,IAAI,CAACV,GAAG,CAACU;IACpB,CAAC;EACH;AACF;AAACC,OAAA,CAAAtB,OAAA,GAAAC,WAAA","ignoreList":[]}